#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>
#include <ctype.h>
#include <malloc.h>
#pragma warning(disable : 4996)

enum { MAX_INSCRIPTIONS = 50, MAX_CARACTERES = 47, MAX_ROLE = 3, MAX_NOM = 31 };

typedef struct {
    char role[MAX_ROLE];
    char nom[MAX_NOM];
}Inscription;

int separer(char commande[], int nb_inscrit, Inscription inscription[]);
int estInscription(char role[], char nom[], int nb_inscrit, Inscription inscription[]);

int main() {
    Inscription inscriptions[MAX_INSCRIPTIONS];
    int nb_inscrit = 0;
    char commande[MAX_CARACTERES], exit[] = "exit\0";
    bool test = true;

    while (test) {
        fgets(commande, MAX_CARACTERES, stdin);

        // Supprimer le caractère de saut de ligne s'il est présent
        size_t len = strlen(commande);
        if (strlen(commande) > 0 && commande[strlen(commande) - 1] == '\n') {
            commande[len - 1] = '\0';
        }

        if (strncmp(commande, exit, sizeof(exit)) == 0) {
            test = false;
        }
        else {
            nb_inscrit = separer(commande, nb_inscrit, inscriptions);
        }
    }


    return 0;
}

int separer(char commande[], int nb_inscrit, Inscription inscription[]) {
    char esp[] = " ";
    char* temp = strtok(commande, esp);

    if (strcmp(temp, "inscription\0") == 0) {
        temp = strtok(NULL, esp);
        return estInscription(temp, strtok(NULL, esp), nb_inscrit, inscription);
    }

    else {
        printf("Error\n");
        return nb_inscrit;
    }
}

int estInscription(char role[], char nom[], int nb_inscrit, Inscription inscription[]) {
    bool test_nom = true;

    if (strcmp(role, "OP\0") == 0 || strcmp(role, "AG\0") == 0 || strcmp(role, "IN\0") == 0) {
        for (int i = 0; i != nb_inscrit; ++i) {
            if (strcmp(inscription[i].nom, nom) == 0)
                test_nom = false;
        }
        if (test_nom) {
            for (int i = 0; i != strlen(role); ++i) 
                inscription[nb_inscrit].role[i] = role[i];

            for (int j = 0; j != strlen(nom); ++j)
                inscription[nb_inscrit].nom[j] = nom[j];
            inscription[nb_inscrit].nom[strlen(nom)] = '\0';
            ++nb_inscrit;
            printf("Inscription realisee (%d)\n", nb_inscrit);
            printf("role : %s\tnom : %s\n", role, nom);
        }
        else {
            printf("Nom incorrect\n");
        }
    }

    else {
        printf("Role incorrect\n");
    }
    return nb_inscrit;
}
